# EdgeVPN çœŸå®åœºæ™¯éƒ¨ç½²ç¤ºä¾‹

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›å¤šç§çœŸå®ä¸šåŠ¡åœºæ™¯ä¸‹çš„ EdgeVPN éƒ¨ç½²ç¤ºä¾‹ï¼Œå¸®åŠ©ç”¨æˆ·æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹æ¡ˆã€‚æ¯ä¸ªåœºæ™¯åŒ…å«è¯¦ç»†çš„æ¶æ„è®¾è®¡ã€éƒ¨ç½²æ­¥éª¤å’Œé…ç½®ç¤ºä¾‹ã€‚

## 2. åœºæ™¯ä¸€ï¼šå®¶åº­åŠå…¬ VPN ç½‘ç»œ

### 2.1 åœºæ™¯æè¿°

é€‚ç”¨äºè¿œç¨‹åŠå…¬åœºæ™¯ï¼Œå‘˜å·¥åœ¨å®¶é€šè¿‡ EdgeVPN å®‰å…¨è®¿é—®å…¬å¸å†…ç½‘èµ„æºï¼Œæ— éœ€é…ç½®å¤æ‚çš„ VPN æœåŠ¡å™¨ã€‚

### 2.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph HOME["ğŸ  å®¶åº­åŠå…¬ç¯å¢ƒ"]
        direction LR
        LAPTOP["ğŸ’» å‘˜å·¥ç¬”è®°æœ¬<br/>IP: 10.1.0.10"]
        PHONE["ğŸ“± å‘˜å·¥æ‰‹æœº<br/>IP: 10.1.0.11"]
    end

    subgraph COMPANY["ğŸ¢ å…¬å¸å†…ç½‘"]
        direction TB
        GW["ğŸšª ç½‘å…³èŠ‚ç‚¹<br/>IP: 10.1.0.1<br/>è¿æ¥å†…ç½‘"]
        FILE["ğŸ“ æ–‡ä»¶æœåŠ¡å™¨<br/>å†…ç½‘: 192.168.1.100"]
        DB["ğŸ—„ï¸ æ•°æ®åº“æœåŠ¡å™¨<br/>å†…ç½‘: 192.168.1.101"]
        WEB["ğŸŒ Web æœåŠ¡<br/>å†…ç½‘: 192.168.1.102"]
    end

    subgraph P2P["ğŸ”— P2P ç½‘ç»œ"]
        direction LR
        EDGE["EdgeVPN<br/>åŠ å¯†éš§é“"]
    end

    LAPTOP -->|"EdgeVPN"| EDGE
    PHONE -->|"EdgeVPN"| EDGE
    EDGE -->|"å®‰å…¨è¿æ¥"| GW
    GW -->|"å†…ç½‘è®¿é—®"| FILE
    GW -->|"å†…ç½‘è®¿é—®"| DB
    GW -->|"å†…ç½‘è®¿é—®"| WEB

    %% æ ·å¼å®šä¹‰
    classDef homeStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef companyStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef p2pStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20

    class LAPTOP,PHONE homeStyle
    class GW,FILE,DB,WEB companyStyle
    class EDGE p2pStyle
```

### 2.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šç”Ÿæˆç½‘ç»œä»¤ç‰Œ

```bash
# åœ¨ä»»æ„æœºå™¨ä¸Šç”Ÿæˆä»¤ç‰Œ
edgevpn -g -b > edgevpn-token.txt

# æŸ¥çœ‹ä»¤ç‰Œå†…å®¹
cat edgevpn-token.txt
```

#### æ­¥éª¤ 2ï¼šéƒ¨ç½²å…¬å¸ç½‘å…³èŠ‚ç‚¹

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /etc/edgevpn/config.yaml << 'EOF'
network:
  token: "ä½ çš„ä»¤ç‰Œå†…å®¹"
  address: "10.1.0.1/24"
  interface: "edgevpn0"
  interface_mtu: 1420

# å¯ç”¨è·¯ç”±è½¬å‘åŠŸèƒ½
routing:
  enabled: true
  forward_traffic: true

# å†…ç½‘è·¯ç”±é…ç½®
routes:
  - destination: "192.168.1.0/24"
    gateway: "10.1.0.1"

logging:
  level: "info"
EOF

# å¯åŠ¨æœåŠ¡
sudo edgevpn --config /etc/edgevpn/config.yaml
```

#### æ­¥éª¤ 3ï¼šé…ç½®ç½‘å…³è·¯ç”±è½¬å‘

```bash
# å¯ç”¨ IP è½¬å‘
sudo sysctl -w net.ipv4.ip_forward=1

# æ°¸ä¹…å¯ç”¨
echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf

# é…ç½® NATï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo iptables -t nat -A POSTROUTING -s 10.1.0.0/24 -o eth0 -j MASQUERADE

# ä¿å­˜ iptables è§„åˆ™
sudo iptables-save > /etc/iptables/rules.v4
```

#### æ­¥éª¤ 4ï¼šå‘˜å·¥å®¶åº­èŠ‚ç‚¹é…ç½®

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > ~/.edgevpn/config.yaml << 'EOF'
network:
  token: "ä½ çš„ä»¤ç‰Œå†…å®¹"
  address: "10.1.0.10/24"
  interface: "edgevpn0"

# æ·»åŠ å†…ç½‘è·¯ç”±
routes:
  - destination: "192.168.1.0/24"
    gateway: "10.1.0.1"

dns:
  enabled: true
  listen: ":53"
  forwarder: true
  forward:
    - "192.168.1.1:53"

logging:
  level: "info"
EOF

# å¯åŠ¨ EdgeVPN
edgevpn --config ~/.edgevpn/config.yaml
```

#### æ­¥éª¤ 5ï¼šéªŒè¯è¿æ¥

```bash
# æ£€æŸ¥ VPN æ¥å£
ifconfig edgevpn0

# æµ‹è¯•è¿æ¥
ping 10.1.0.1

# æµ‹è¯•å†…ç½‘è®¿é—®
ping 192.168.1.100

# æµ‹è¯• Web æœåŠ¡
curl http://192.168.1.102
```

### 2.4 é…ç½®è¯´æ˜

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| `network.token` | ç½‘ç»œå…±äº«ä»¤ç‰Œï¼Œæ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒä»¤ç‰Œ |
| `network.address` | VPN è™šæ‹Ÿ IP åœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹å”¯ä¸€ |
| `routing.enabled` | å¯ç”¨è·¯ç”±è½¬å‘åŠŸèƒ½ |
| `routes` | é…ç½®é™æ€è·¯ç”±ï¼ŒæŒ‡å‘å†…ç½‘ç½‘æ®µ |

### 2.5 æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§**ï¼šä»¤ç‰Œåº”å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²ç»™å¤–éƒ¨äººå‘˜
2. **å¸¦å®½**ï¼šå®¶åº­ç½‘ç»œå¸¦å®½å¯èƒ½æœ‰é™ï¼Œå»ºè®®ä¼˜åŒ–æµé‡
3. **ç¨³å®šæ€§**ï¼šä½¿ç”¨ systemd æœåŠ¡ä¿æŒé•¿æœŸè¿è¡Œ
4. **DNS**ï¼šé…ç½®å†…ç½‘ DNS æœåŠ¡å™¨ä¾¿äºè®¿é—®å†…ç½‘èµ„æº

---

## 3. åœºæ™¯äºŒï¼šå¼€å‘æµ‹è¯•ç¯å¢ƒäº’è”

### 3.1 åœºæ™¯æè¿°

é€‚ç”¨äºå¼€å‘å›¢é˜Ÿï¼Œå¤šä¸ªå¼€å‘è€…çš„æœ¬åœ°å¼€å‘ç¯å¢ƒé€šè¿‡ EdgeVPN äº’è”ï¼Œå®ç°è·¨æœºå™¨çš„æœåŠ¡è°ƒç”¨å’Œè°ƒè¯•ã€‚

### 3.2 æ¶æ„å›¾

```mermaid
flowchart LR
    subgraph DEV1["ğŸ‘¨â€ğŸ’» å¼€å‘è€… A"]
        direction TB
        D1_API["API æœåŠ¡<br/>:8080"]
        D1_DB["æ•°æ®åº“<br/>:3306"]
        D1_VPN["EdgeVPN<br/>10.2.0.1"]
    end

    subgraph DEV2["ğŸ‘©â€ğŸ’» å¼€å‘è€… B"]
        direction TB
        D2_WEB["Web å‰ç«¯<br/>:3000"]
        D2_CACHE["Redis ç¼“å­˜<br/>:6379"]
        D2_VPN["EdgeVPN<br/>10.2.0.2"]
    end

    subgraph DEV3["ğŸ‘¨â€ğŸ’» å¼€å‘è€… C"]
        direction TB
        D3_SVC["å¾®æœåŠ¡<br/>:9000"]
        D3_MQ["æ¶ˆæ¯é˜Ÿåˆ—<br/>:5672"]
        D3_VPN["EdgeVPN<br/>10.2.0.3"]
    end

    D1_VPN <-->|"P2P"| D2_VPN
    D2_VPN <-->|"P2P"| D3_VPN
    D1_VPN <-->|"P2P"| D3_VPN

    D2_WEB -->|"è°ƒç”¨"| D1_API
    D1_API -->|"å­˜å‚¨"| D2_CACHE
    D3_SVC -->|"æŸ¥è¯¢"| D1_DB

    %% æ ·å¼å®šä¹‰
    classDef devStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef serviceStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef vpnStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20

    class D1_API,D1_DB,D2_WEB,D2_CACHE,D3_SVC,D3_MQ serviceStyle
    class D1_VPN,D2_VPN,D3_VPN vpnStyle
```

### 3.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šåˆ›å»ºå¼€å‘ç½‘ç»œä»¤ç‰Œ

```bash
# ç”Ÿæˆå¼€å‘ç¯å¢ƒä¸“ç”¨ä»¤ç‰Œ
edgevpn -g -b > dev-network-token.txt

# å°†ä»¤ç‰Œåˆ†å‘ç»™å›¢é˜Ÿæˆå‘˜
# é€šè¿‡å®‰å…¨æ¸ é“ï¼ˆå¦‚åŠ å¯†é‚®ä»¶ã€å¯†ç ç®¡ç†å™¨ï¼‰åˆ†äº«
```

#### æ­¥éª¤ 2ï¼šå¼€å‘è€… A é…ç½®ï¼ˆAPI + æ•°æ®åº“ï¼‰

```bash
# åˆ›å»ºé…ç½®
cat > ~/.edgevpn/dev-config.yaml << 'EOF'
network:
  token: "å¼€å‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.2.0.1/24"
  interface: "edgevpn0"

# å¯ç”¨ API ä¾¿äºè°ƒè¯•
api:
  enabled: true
  listen: "0.0.0.0:8080"

# DNS æœåŠ¡
dns:
  enabled: true
  listen: ":5353"
  
  # æ³¨å†Œæœ¬åœ°æœåŠ¡
  records:
    - pattern: "api.dev.local"
      type: "A"
      value: "10.2.0.1"
      ttl: 60
    - pattern: "db.dev.local"
      type: "A"
      value: "10.2.0.1"
      ttl: 60

# æœåŠ¡æ³¨å†Œ
services:
  - name: "api-service"
    address: "10.2.0.1:8080"
  - name: "mysql-service"
    address: "10.2.0.1:3306"

logging:
  level: "debug"
EOF

# å¯åŠ¨
edgevpn --config ~/.edgevpn/dev-config.yaml
```

#### æ­¥éª¤ 3ï¼šå¼€å‘è€… B é…ç½®ï¼ˆWeb + Redisï¼‰

```bash
cat > ~/.edgevpn/dev-config.yaml << 'EOF'
network:
  token: "å¼€å‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.2.0.2/24"
  interface: "edgevpn0"

dns:
  enabled: true
  listen: ":5353"
  records:
    - pattern: "web.dev.local"
      type: "A"
      value: "10.2.0.2"
      ttl: 60
    - pattern: "redis.dev.local"
      type: "A"
      value: "10.2.0.2"
      ttl: 60

services:
  - name: "web-frontend"
    address: "10.2.0.2:3000"
  - name: "redis-service"
    address: "10.2.0.2:6379"

logging:
  level: "debug"
EOF

edgevpn --config ~/.edgevpn/dev-config.yaml
```

#### æ­¥éª¤ 4ï¼šå¼€å‘è€… C é…ç½®ï¼ˆå¾®æœåŠ¡ + MQï¼‰

```bash
cat > ~/.edgevpn/dev-config.yaml << 'EOF'
network:
  token: "å¼€å‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.2.0.3/24"
  interface: "edgevpn0"

dns:
  enabled: true
  listen: ":5353"
  records:
    - pattern: "svc.dev.local"
      type: "A"
      value: "10.2.0.3"
      ttl: 60
    - pattern: "mq.dev.local"
      type: "A"
      value: "10.2.0.3"
      ttl: 60

services:
  - name: "microservice"
    address: "10.2.0.3:9000"
  - name: "rabbitmq"
    address: "10.2.0.3:5672"

logging:
  level: "debug"
EOF

edgevpn --config ~/.edgevpn/dev-config.yaml
```

#### æ­¥éª¤ 5ï¼šé…ç½®æœ¬åœ° DNS

```bash
# é…ç½®ç³»ç»Ÿä½¿ç”¨ EdgeVPN DNS
# Linux
sudo resolvectl dns edgevpn0 127.0.0.1:5353

# macOS
sudo networksetup -setdnsservers "Wi-Fi" 127.0.0.1

# æˆ–åœ¨åº”ç”¨é…ç½®ä¸­ä½¿ç”¨
# ä¾‹å¦‚ Web åº”ç”¨é…ç½®
cat > web-app-config.json << 'EOF'
{
  "api_url": "http://api.dev.local:8080",
  "db_host": "db.dev.local",
  "redis_host": "redis.dev.local"
}
EOF
```

### 3.4 æœåŠ¡å‘ç°å’Œè°ƒç”¨

```bash
# æŸ¥çœ‹ç½‘ç»œä¸­çš„æ‰€æœ‰æœåŠ¡
curl http://localhost:8080/api/services

# æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
curl http://localhost:8080/api/nodes

# ä½¿ç”¨ DNS åç§°è®¿é—®æœåŠ¡
curl http://api.dev.local:8080/health
mysql -h db.dev.local -u root -p
redis-cli -h redis.dev.local ping
```

### 3.5 æ³¨æ„äº‹é¡¹

1. **ç«¯å£å†²çª**ï¼šç¡®ä¿æœ¬åœ°æœåŠ¡ç«¯å£ä¸ä¸ EdgeVPN å†²çª
2. **DNS é…ç½®**ï¼šæ‰€æœ‰å¼€å‘è€…ä½¿ç”¨ç›¸åŒçš„ DNS å‘½åè§„èŒƒ
3. **æ—¥å¿—çº§åˆ«**ï¼šå¼€å‘ç¯å¢ƒå¯ä½¿ç”¨ debug çº§åˆ«ä¾¿äºæ’æŸ¥é—®é¢˜
4. **æœåŠ¡æ³¨å†Œ**ï¼šå®šæœŸæ›´æ–°æœåŠ¡æ³¨å†Œä¿¡æ¯

---

## 4. åœºæ™¯ä¸‰ï¼šå¤šåœ°åŸŸåˆ†å¸ƒå¼å›¢é˜Ÿåä½œ

### 4.1 åœºæ™¯æè¿°

é€‚ç”¨äºè·¨åœ°åŸŸçš„åˆ†å¸ƒå¼å›¢é˜Ÿï¼Œä¸åŒåœ°åŒºçš„åŠå…¬å®¤é€šè¿‡ EdgeVPN å»ºç«‹ç§æœ‰ç½‘ç»œï¼Œå®ç°èµ„æºå…±äº«å’ŒååŒå·¥ä½œã€‚

### 4.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph BEIJING["ğŸ¢ åŒ—äº¬åŠå…¬å®¤"]
        direction TB
        BJ_VPN["EdgeVPN ç½‘å…³<br/>10.3.0.1"]
        BJ_FILE["æ–‡ä»¶æœåŠ¡å™¨<br/>å†…ç½‘: 172.16.1.10"]
        BJ_GIT["Git æœåŠ¡å™¨<br/>å†…ç½‘: 172.16.1.11"]
    end

    subgraph SHANGHAI["ğŸ¢ ä¸Šæµ·åŠå…¬å®¤"]
        direction TB
        SH_VPN["EdgeVPN ç½‘å…³<br/>10.3.0.2"]
        SH_JENKINS["Jenkins CI<br/>å†…ç½‘: 172.16.2.10"]
        SH_NEXUS["Nexus ä»“åº“<br/>å†…ç½‘: 172.16.2.11"]
    end

    subgraph SHENZHEN["ğŸ¢ æ·±åœ³åŠå…¬å®¤"]
        direction TB
        SZ_VPN["EdgeVPN ç½‘å…³<br/>10.3.0.3"]
        SZ_K8S["Kubernetes<br/>å†…ç½‘: 172.16.3.10"]
        SZ_MONITOR["ç›‘æ§ç³»ç»Ÿ<br/>å†…ç½‘: 172.16.3.11"]
    end

    subgraph CLOUD["â˜ï¸ äº‘ç«¯ä¸­ç»§"]
        RELAY["ä¸­ç»§èŠ‚ç‚¹<br/>10.3.0.100"]
    end

    BJ_VPN <-->|"P2P"| SH_VPN
    SH_VPN <-->|"P2P"| SZ_VPN
    BJ_VPN <-->|"P2P"| SZ_VPN
    
    BJ_VPN -.->|"ä¸­ç»§"| RELAY
    SH_VPN -.->|"ä¸­ç»§"| RELAY
    SZ_VPN -.->|"ä¸­ç»§"| RELAY

    %% æ ·å¼å®šä¹‰
    classDef officeStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef serverStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef cloudStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20

    class BJ_VPN,SH_VPN,SZ_VPN officeStyle
    class BJ_FILE,BJ_GIT,SH_JENKINS,SH_NEXUS,SZ_K8S,SZ_MONITOR serverStyle
    class RELAY cloudStyle
```

### 4.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šéƒ¨ç½²äº‘ç«¯ä¸­ç»§èŠ‚ç‚¹

```bash
# åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸­ç»§èŠ‚ç‚¹
cat > /etc/edgevpn/relay-config.yaml << 'EOF'
network:
  token: "åˆ†å¸ƒå¼ç½‘ç»œä»¤ç‰Œ"
  address: "10.3.0.100/24"
  interface: "edgevpn0"

# ä¸­ç»§é…ç½®
relay:
  enabled: true
  listen: "0.0.0.0:4001"

# å…¬ç½‘è®¿é—®é…ç½®
nat:
  traversal: true
  stun_server: "stun.l.google.com:19302"

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

# å¯åŠ¨ä¸­ç»§æœåŠ¡
edgevpn --config /etc/edgevpn/relay-config.yaml
```

#### æ­¥éª¤ 2ï¼šåŒ—äº¬åŠå…¬å®¤ç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/beijing-config.yaml << 'EOF'
network:
  token: "åˆ†å¸ƒå¼ç½‘ç»œä»¤ç‰Œ"
  address: "10.3.0.1/24"
  interface: "edgevpn0"

# å¼•å¯¼èŠ‚ç‚¹ï¼ˆä¸­ç»§ï¼‰
bootstrap:
  - "/ip4/äº‘æœåŠ¡å™¨å…¬ç½‘IP/tcp/4001/p2p/ä¸­ç»§èŠ‚ç‚¹PeerID"

# è·¯ç”±é…ç½®
routing:
  enabled: true
  routes:
    - destination: "172.16.1.0/24"
      gateway: "10.3.0.1"
    - destination: "172.16.2.0/24"
      gateway: "10.3.0.2"
    - destination: "172.16.3.0/24"
      gateway: "10.3.0.3"

# NAT ç©¿é€
nat:
  traversal: true
  upnp: true

dns:
  enabled: true
  listen: ":53"
  forwarder: true
  forward:
    - "114.114.114.114:53"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/beijing-config.yaml
```

#### æ­¥éª¤ 3ï¼šä¸Šæµ·åŠå…¬å®¤ç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/shanghai-config.yaml << 'EOF'
network:
  token: "åˆ†å¸ƒå¼ç½‘ç»œä»¤ç‰Œ"
  address: "10.3.0.2/24"
  interface: "edgevpn0"

bootstrap:
  - "/ip4/äº‘æœåŠ¡å™¨å…¬ç½‘IP/tcp/4001/p2p/ä¸­ç»§èŠ‚ç‚¹PeerID"

routing:
  enabled: true
  routes:
    - destination: "172.16.1.0/24"
      gateway: "10.3.0.1"
    - destination: "172.16.2.0/24"
      gateway: "10.3.0.2"
    - destination: "172.16.3.0/24"
      gateway: "10.3.0.3"

nat:
  traversal: true
  upnp: true

dns:
  enabled: true
  listen: ":53"
  forwarder: true

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/shanghai-config.yaml
```

#### æ­¥éª¤ 4ï¼šæ·±åœ³åŠå…¬å®¤ç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/shenzhen-config.yaml << 'EOF'
network:
  token: "åˆ†å¸ƒå¼ç½‘ç»œä»¤ç‰Œ"
  address: "10.3.0.3/24"
  interface: "edgevpn0"

bootstrap:
  - "/ip4/äº‘æœåŠ¡å™¨å…¬ç½‘IP/tcp/4001/p2p/ä¸­ç»§èŠ‚ç‚¹PeerID"

routing:
  enabled: true
  routes:
    - destination: "172.16.1.0/24"
      gateway: "10.3.0.1"
    - destination: "172.16.2.0/24"
      gateway: "10.3.0.2"
    - destination: "172.16.3.0/24"
      gateway: "10.3.0.3"

nat:
  traversal: true
  upnp: true

dns:
  enabled: true
  listen: ":53"
  forwarder: true

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/shenzhen-config.yaml
```

#### æ­¥éª¤ 5ï¼šé…ç½®åŠå…¬å®¤å†…ç½‘è·¯ç”±

```bash
# åœ¨å„åŠå…¬å®¤çš„å†…ç½‘è·¯ç”±å™¨ä¸Šæ·»åŠ è·¯ç”±
# åŒ—äº¬åŠå…¬å®¤
ip route add 10.3.0.0/24 via 10.3.0.1
ip route add 172.16.2.0/24 via 10.3.0.2
ip route add 172.16.3.0/24 via 10.3.0.3

# ä¸Šæµ·åŠå…¬å®¤
ip route add 10.3.0.0/24 via 10.3.0.2
ip route add 172.16.1.0/24 via 10.3.0.1
ip route add 172.16.3.0/24 via 10.3.0.3

# æ·±åœ³åŠå…¬å®¤
ip route add 10.3.0.0/24 via 10.3.0.3
ip route add 172.16.1.0/24 via 10.3.0.1
ip route add 172.16.2.0/24 via 10.3.0.2
```

### 4.4 è·¨åœ°åŸŸè®¿é—®ç¤ºä¾‹

```bash
# åŒ—äº¬è®¿é—®ä¸Šæµ· Jenkins
curl http://172.16.2.10:8080

# ä¸Šæµ·è®¿é—®åŒ—äº¬ Git
git clone http://172.16.1.11/project.git

# æ·±åœ³è®¿é—®åŒ—äº¬æ–‡ä»¶æœåŠ¡å™¨
scp user@172.16.1.10:/data/file.txt ./

# æ‰€æœ‰åŠå…¬å®¤è®¿é—®æ·±åœ³ç›‘æ§
http://172.16.3.11:3000
```

### 4.5 æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œå»¶è¿Ÿ**ï¼šè·¨åœ°åŸŸè¿æ¥å¯èƒ½æœ‰è¾ƒé«˜å»¶è¿Ÿï¼Œå»ºè®®ä¼˜åŒ–åº”ç”¨
2. **å¸¦å®½æˆæœ¬**ï¼šè·¨åœ°åŸŸæµé‡ä¼šäº§ç”Ÿå¸¦å®½æˆæœ¬ï¼Œéœ€è¦ç›‘æ§
3. **æ—¶åŒºåŒæ­¥**ï¼šç¡®ä¿æ‰€æœ‰æœåŠ¡å™¨æ—¶åŒºé…ç½®æ­£ç¡®
4. **å¤‡ä»½ç­–ç•¥**ï¼šé‡è¦æ•°æ®éœ€è¦è·¨åœ°åŸŸå¤‡ä»½

---

## 5. åœºæ™¯å››ï¼šIoT è®¾å¤‡äº’è”

### 5.1 åœºæ™¯æè¿°

é€‚ç”¨äºç‰©è”ç½‘åœºæ™¯ï¼Œå¤§é‡ IoT è®¾å¤‡é€šè¿‡ EdgeVPN å®‰å…¨äº’è”ï¼Œå®ç°è®¾å¤‡ç®¡ç†å’Œæ•°æ®é‡‡é›†ã€‚

### 5.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph IOT["ğŸ“¡ IoT è®¾å¤‡å±‚"]
        direction LR
        SENSOR1["ä¼ æ„Ÿå™¨ A<br/>10.4.0.11"]
        SENSOR2["ä¼ æ„Ÿå™¨ B<br/>10.4.0.12"]
        CAMERA["æ‘„åƒå¤´<br/>10.4.0.13"]
        GATEWAY["è¾¹ç¼˜ç½‘å…³<br/>10.4.0.10"]
    end

    subgraph EDGE["ğŸ–¥ï¸ è¾¹ç¼˜è®¡ç®—å±‚"]
        direction TB
        EDGE_NODE["è¾¹ç¼˜èŠ‚ç‚¹<br/>10.4.0.2"]
        EDGE_DB["æ—¶åºæ•°æ®åº“"]
        EDGE_MQ["æ¶ˆæ¯é˜Ÿåˆ—"]
    end

    subgraph CLOUD["â˜ï¸ äº‘å¹³å°å±‚"]
        direction TB
        CLOUD_VPN["äº‘ç«¯ VPN<br/>10.4.0.1"]
        CLOUD_API["ç®¡ç† API"]
        CLOUD_DB["äº‘ç«¯æ•°æ®åº“"]
        DASHBOARD["ç›‘æ§é¢æ¿"]
    end

    SENSOR1 -->|"æ•°æ®ä¸ŠæŠ¥"| GATEWAY
    SENSOR2 -->|"æ•°æ®ä¸ŠæŠ¥"| GATEWAY
    CAMERA -->|"è§†é¢‘æµ"| GATEWAY
    GATEWAY -->|"EdgeVPN"| EDGE_NODE
    
    EDGE_NODE --> EDGE_DB
    EDGE_NODE --> EDGE_MQ
    EDGE_NODE -->|"EdgeVPN"| CLOUD_VPN
    
    CLOUD_VPN --> CLOUD_API
    CLOUD_API --> CLOUD_DB
    CLOUD_API --> DASHBOARD

    %% æ ·å¼å®šä¹‰
    classDef iotStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef edgeStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef cloudStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20

    class SENSOR1,SENSOR2,CAMERA,GATEWAY iotStyle
    class EDGE_NODE,EDGE_DB,EDGE_MQ edgeStyle
    class CLOUD_VPN,CLOUD_API,CLOUD_DB,DASHBOARD cloudStyle
```

### 5.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šäº‘ç«¯ç®¡ç†èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/cloud-config.yaml << 'EOF'
network:
  token: "IoT ç½‘ç»œä»¤ç‰Œ"
  address: "10.4.0.1/24"
  interface: "edgevpn0"

# é«˜å¯ç”¨é…ç½®
high_availability:
  enabled: true
  max_connections: 500
  max_streams: 100

# API æœåŠ¡
api:
  enabled: true
  listen: "0.0.0.0:8080"

# DNS æœåŠ¡
dns:
  enabled: true
  listen: ":53"
  
  # IoT è®¾å¤‡ DNS è®°å½•
  records:
    - pattern: "*.iot.local"
      type: "A"
      value: "10.4.0.1"
      ttl: 60

# ä¿¡ä»»åŒºåŸŸï¼ˆä»…å…è®¸æˆæƒè®¾å¤‡ï¼‰
trustzone:
  enabled: true
  auth_method: "ecdsa"
  authorized_keys:
    - "è®¾å¤‡å…¬é’¥åˆ—è¡¨"

logging:
  level: "warn"
EOF

edgevpn --config /etc/edgevpn/cloud-config.yaml
```

#### æ­¥éª¤ 2ï¼šè¾¹ç¼˜èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/edge-config.yaml << 'EOF'
network:
  token: "IoT ç½‘ç»œä»¤ç‰Œ"
  address: "10.4.0.2/24"
  interface: "edgevpn0"

# å¼•å¯¼èŠ‚ç‚¹
bootstrap:
  - "/ip4/äº‘ç«¯IP/tcp/4001/p2p/äº‘ç«¯PeerID"

# èµ„æºé™åˆ¶ï¼ˆè¾¹ç¼˜è®¾å¤‡èµ„æºæœ‰é™ï¼‰
limits:
  max_connections: 100
  max_streams: 30
  bandwidth_limit: "10MB/s"

# æ•°æ®è½¬å‘
forwarding:
  enabled: true
  upstream: "10.4.0.1:8080"

# æœ¬åœ°ç¼“å­˜
cache:
  enabled: true
  size: "100MB"

logging:
  level: "warn"
EOF

edgevpn --config /etc/edgevpn/edge-config.yaml
```

#### æ­¥éª¤ 3ï¼šIoT ç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/gateway-config.yaml << 'EOF'
network:
  token: "IoT ç½‘ç»œä»¤ç‰Œ"
  address: "10.4.0.10/24"
  interface: "edgevpn0"

# ä½åŠŸè€—æ¨¡å¼
power_save:
  enabled: true
  sleep_interval: "30s"

# æ•°æ®æ‰¹é‡ä¸ŠæŠ¥
batch:
  enabled: true
  size: 100
  interval: "60s"

# æœ¬åœ°å­˜å‚¨ï¼ˆç¦»çº¿ç¼“å­˜ï¼‰
storage:
  enabled: true
  path: "/var/lib/edgevpn/cache"
  max_size: "1GB"

# æœåŠ¡æ³¨å†Œ
services:
  - name: "iot-gateway"
    address: "10.4.0.10:1883"  # MQTT
  - name: "iot-data"
    address: "10.4.0.10:8080"

logging:
  level: "error"
EOF

edgevpn --config /etc/edgevpn/gateway-config.yaml
```

#### æ­¥éª¤ 4ï¼šIoT è®¾å¤‡é…ç½®ï¼ˆä¼ æ„Ÿå™¨ï¼‰

```bash
# åµŒå…¥å¼è®¾å¤‡é…ç½®ï¼ˆç®€åŒ–ç‰ˆï¼‰
cat > /etc/edgevpn/sensor-config.yaml << 'EOF'
network:
  token: "IoT ç½‘ç»œä»¤ç‰Œ"
  address: "10.4.0.11/24"
  interface: "edgevpn0"

# æœ€å°èµ„æºé…ç½®
limits:
  max_connections: 10
  max_streams: 5

# å¿ƒè·³ä¸ŠæŠ¥
heartbeat:
  enabled: true
  interval: "300s"
  target: "10.4.0.10"

# æ•°æ®ä¸ŠæŠ¥
data_report:
  enabled: true
  target: "10.4.0.10:1883"
  topic: "sensors/data"
  interval: "60s"

logging:
  level: "error"
EOF

edgevpn --config /etc/edgevpn/sensor-config.yaml
```

### 5.4 è®¾å¤‡ç®¡ç† API

```bash
# æŸ¥çœ‹æ‰€æœ‰ IoT è®¾å¤‡
curl http://10.4.0.1:8080/api/machines

# æŸ¥çœ‹è®¾å¤‡çŠ¶æ€
curl http://10.4.0.1:8080/api/nodes

# å‘é€å‘½ä»¤åˆ°è®¾å¤‡
curl -X POST http://10.4.0.1:8080/api/send \
  -d '{"peer_id": "è®¾å¤‡PeerID", "command": "reboot"}'

# æŸ¥çœ‹è®¾å¤‡æ•°æ®
curl http://10.4.0.1:8080/api/data/sensors
```

### 5.5 æ³¨æ„äº‹é¡¹

1. **è®¾å¤‡è®¤è¯**ï¼šå¯ç”¨ä¿¡ä»»åŒºåŸŸé˜²æ­¢æœªæˆæƒè®¾å¤‡æ¥å…¥
2. **èµ„æºé™åˆ¶**ï¼šIoT è®¾å¤‡èµ„æºæœ‰é™ï¼Œéœ€è¦åˆç†é…ç½®
3. **ç¦»çº¿ç¼“å­˜**ï¼šè®¾å¤‡ç¦»çº¿æ—¶éœ€è¦æœ¬åœ°ç¼“å­˜æ•°æ®
4. **æ‰¹é‡ä¸ŠæŠ¥**ï¼šå‡å°‘ç½‘ç»œå¼€é”€ï¼Œä½¿ç”¨æ‰¹é‡æ•°æ®ä¸ŠæŠ¥
5. **å®‰å…¨æ›´æ–°**ï¼šå®šæœŸæ›´æ–°è®¾å¤‡å›ºä»¶å’Œ EdgeVPN ç‰ˆæœ¬

---

## 6. åœºæ™¯äº”ï¼šå®‰å…¨æ–‡ä»¶å…±äº«

### 6.1 åœºæ™¯æè¿°

é€‚ç”¨äºéœ€è¦å®‰å…¨å…±äº«æ–‡ä»¶çš„åœºæ™¯ï¼Œé€šè¿‡ EdgeVPN å»ºç«‹çš„åŠ å¯†é€šé“ä¼ è¾“æ•æ„Ÿæ–‡ä»¶ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨ã€‚

### 6.2 æ¶æ„å›¾

```mermaid
flowchart LR
    subgraph SENDER["ğŸ“¤ æ–‡ä»¶å‘é€æ–¹"]
        direction TB
        S_CLIENT["å®¢æˆ·ç«¯"]
        S_VPN["EdgeVPN<br/>10.5.0.1"]
        S_FILE["å¾…å‘é€æ–‡ä»¶"]
    end

    subgraph NETWORK["ğŸ” P2P åŠ å¯†ç½‘ç»œ"]
        direction TB
        ENCRYPT["AES åŠ å¯†"]
        TRANSFER["P2P ä¼ è¾“"]
    end

    subgraph RECEIVER["ğŸ“¥ æ–‡ä»¶æ¥æ”¶æ–¹"]
        direction TB
        R_VPN["EdgeVPN<br/>10.5.0.2"]
        R_CLIENT["å®¢æˆ·ç«¯"]
        R_FILE["æ¥æ”¶æ–‡ä»¶"]
    end

    S_CLIENT -->|"é€‰æ‹©æ–‡ä»¶"| S_FILE
    S_FILE -->|"åŠ å¯†"| ENCRYPT
    ENCRYPT -->|"ä¼ è¾“"| TRANSFER
    TRANSFER -->|"æ¥æ”¶"| R_VPN
    R_VPN -->|"è§£å¯†"| R_FILE
    R_FILE -->|"ä¿å­˜"| R_CLIENT

    S_VPN <-->|"P2P"| R_VPN

    %% æ ·å¼å®šä¹‰
    classDef clientStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef networkStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef vpnStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20

    class S_CLIENT,R_CLIENT clientStyle
    class ENCRYPT,TRANSFER networkStyle
    class S_VPN,R_VPN vpnStyle
```

### 6.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šå‘é€æ–¹é…ç½®

```bash
cat > ~/.edgevpn/fileshare-config.yaml << 'EOF'
network:
  token: "æ–‡ä»¶å…±äº«ä»¤ç‰Œ"
  address: "10.5.0.1/24"
  interface: "edgevpn0"

# æ–‡ä»¶å…±äº«é…ç½®
fileshare:
  enabled: true
  shared_dir: "/home/user/shared"
  max_file_size: "1GB"
  
# ä¿¡ä»»åŒºåŸŸ
trustzone:
  enabled: true
  auth_method: "ecdsa"
  public_key: "å‘é€æ–¹å…¬é’¥"
  authorized_keys:
    - "æ¥æ”¶æ–¹å…¬é’¥"

logging:
  level: "info"
EOF

edgevpn --config ~/.edgevpn/fileshare-config.yaml
```

#### æ­¥éª¤ 2ï¼šæ¥æ”¶æ–¹é…ç½®

```bash
cat > ~/.edgevpn/fileshare-config.yaml << 'EOF'
network:
  token: "æ–‡ä»¶å…±äº«ä»¤ç‰Œ"
  address: "10.5.0.2/24"
  interface: "edgevpn0"

fileshare:
  enabled: true
  download_dir: "/home/user/downloads"
  auto_accept: false  # æ‰‹åŠ¨ç¡®è®¤æ¥æ”¶

trustzone:
  enabled: true
  auth_method: "ecdsa"
  public_key: "æ¥æ”¶æ–¹å…¬é’¥"
  authorized_keys:
    - "å‘é€æ–¹å…¬é’¥"

logging:
  level: "info"
EOF

edgevpn --config ~/.edgevpn/fileshare-config.yaml
```

#### æ­¥éª¤ 3ï¼šå‘é€æ–‡ä»¶

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨å‘½ä»¤è¡Œ
edgevpn file send \
  --file /path/to/sensitive.doc \
  --peer "æ¥æ”¶æ–¹PeerID" \
  --timeout 300s

# æ–¹å¼äºŒï¼šä½¿ç”¨ API
curl -X POST http://localhost:8080/api/file/send \
  -F "file=@/path/to/sensitive.doc" \
  -F "peer_id=æ¥æ”¶æ–¹PeerID"

# æ–¹å¼ä¸‰ï¼šå…±äº«æ–‡ä»¶ç›®å½•
# å°†æ–‡ä»¶æ”¾å…¥å…±äº«ç›®å½•ï¼Œè‡ªåŠ¨å…¬å‘Š
cp sensitive.doc /home/user/shared/
```

#### æ­¥éª¤ 4ï¼šæ¥æ”¶æ–‡ä»¶

```bash
# æŸ¥çœ‹å¯ç”¨æ–‡ä»¶åˆ—è¡¨
edgevpn file list

# æ¥æ”¶æŒ‡å®šæ–‡ä»¶
edgevpn file receive \
  --file-id "æ–‡ä»¶ID" \
  --output /home/user/downloads/

# æˆ–ä½¿ç”¨ API
curl http://localhost:8080/api/files

curl -X POST http://localhost:8080/api/file/receive \
  -d '{"file_id": "æ–‡ä»¶ID", "output_path": "/home/user/downloads/"}'
```

### 6.4 æ–‡ä»¶ä¼ è¾“æµç¨‹

```mermaid
sequenceDiagram
    participant A as å‘é€æ–¹
    participant VPN as EdgeVPN ç½‘ç»œ
    participant B as æ¥æ”¶æ–¹
    
    A->>VPN: å…¬å‘Šæ–‡ä»¶ä¿¡æ¯
    VPN->>B: å¹¿æ’­æ–‡ä»¶å…¬å‘Š
    B->>VPN: è¯·æ±‚æ–‡ä»¶åˆ—è¡¨
    VPN->>B: è¿”å›æ–‡ä»¶åˆ—è¡¨
    B->>VPN: è¯·æ±‚ä¸‹è½½æ–‡ä»¶
    VPN->>A: è½¬å‘ä¸‹è½½è¯·æ±‚
    A->>VPN: å»ºç«‹ P2P æµ
    VPN->>B: å»ºç«‹ P2P æµ
    A->>B: åŠ å¯†ä¼ è¾“æ–‡ä»¶
    B->>B: éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
    B->>VPN: ç¡®è®¤æ¥æ”¶å®Œæˆ
    VPN->>A: é€šçŸ¥ä¼ è¾“å®Œæˆ
```

### 6.5 æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¤§å°**ï¼šå¤§æ–‡ä»¶ä¼ è¾“éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®åˆ†ç‰‡ä¼ è¾“
2. **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œç½‘ç»œä¸­æ–­åå¯ç»§ç»­ä¼ è¾“
3. **å®Œæ•´æ€§æ ¡éªŒ**ï¼šä¼ è¾“å®Œæˆåè‡ªåŠ¨æ ¡éªŒæ–‡ä»¶å“ˆå¸Œ
4. **è®¿é—®æ§åˆ¶**ï¼šå¯ç”¨ä¿¡ä»»åŒºåŸŸç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·å¯ä»¥è®¿é—®
5. **æ—¥å¿—å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰æ–‡ä»¶ä¼ è¾“æ“ä½œ

---

## 7. åœºæ™¯å…­ï¼šå¾®æœåŠ¡äº’è”

### 7.1 åœºæ™¯æè¿°

é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ï¼Œå¤šä¸ªå¾®æœåŠ¡å®ä¾‹é€šè¿‡ EdgeVPN äº’è”ï¼Œå®ç°æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚

### 7.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph CLUSTER["ğŸ–¥ï¸ å¾®æœåŠ¡é›†ç¾¤"]
        direction TB
        
        subgraph GATEWAY["API ç½‘å…³"]
            GW1["ç½‘å…³å®ä¾‹ 1<br/>10.6.0.1"]
            GW2["ç½‘å…³å®ä¾‹ 2<br/>10.6.0.2"]
        end
        
        subgraph SERVICES["å¾®æœåŠ¡å±‚"]
            SVC_A1["æœåŠ¡ A-1<br/>10.6.0.11"]
            SVC_A2["æœåŠ¡ A-2<br/>10.6.0.12"]
            SVC_B1["æœåŠ¡ B-1<br/>10.6.0.21"]
            SVC_B2["æœåŠ¡ B-2<br/>10.6.0.22"]
        end
        
        subgraph DATA["æ•°æ®å±‚"]
            DB1["æ•°æ®åº“ä¸»<br/>10.6.0.101"]
            DB2["æ•°æ®åº“ä»<br/>10.6.0.102"]
            CACHE["ç¼“å­˜é›†ç¾¤<br/>10.6.0.103"]
        end
    end

    subgraph DISCOVERY["ğŸ” æœåŠ¡å‘ç°"]
        LEDGER["åŒºå—é“¾è´¦æœ¬"]
    end

    GW1 --> SVC_A1
    GW1 --> SVC_A2
    GW2 --> SVC_B1
    GW2 --> SVC_B2
    
    SVC_A1 --> DB1
    SVC_A2 --> DB2
    SVC_B1 --> CACHE
    SVC_B2 --> CACHE
    
    GW1 -.->|"æ³¨å†Œ"| LEDGER
    SVC_A1 -.->|"æ³¨å†Œ"| LEDGER
    SVC_B1 -.->|"æ³¨å†Œ"| LEDGER
    DB1 -.->|"æ³¨å†Œ"| LEDGER

    %% æ ·å¼å®šä¹‰
    classDef gatewayStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef serviceStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef dataStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20
    classDef discoveryStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#4A148C

    class GW1,GW2 gatewayStyle
    class SVC_A1,SVC_A2,SVC_B1,SVC_B2 serviceStyle
    class DB1,DB2,CACHE dataStyle
    class LEDGER discoveryStyle
```

### 7.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šAPI ç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/gateway-config.yaml << 'EOF'
network:
  token: "å¾®æœåŠ¡ç½‘ç»œä»¤ç‰Œ"
  address: "10.6.0.1/24"
  interface: "edgevpn0"

# æœåŠ¡æ³¨å†Œ
services:
  - name: "api-gateway"
    address: "10.6.0.1:8080"
    tags: ["gateway", "api", "public"]
    health_check: "/health"
    health_interval: "30s"

# è´Ÿè½½å‡è¡¡
load_balancing:
  enabled: true
  algorithm: "round_robin"
  health_check: true

# æœåŠ¡å‘ç°
discovery:
  enabled: true
  refresh_interval: "10s"

# API é…ç½®
api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/gateway-config.yaml
```

#### æ­¥éª¤ 2ï¼šå¾®æœåŠ¡ A é…ç½®

```bash
cat > /etc/edgevpn/service-a-config.yaml << 'EOF'
network:
  token: "å¾®æœåŠ¡ç½‘ç»œä»¤ç‰Œ"
  address: "10.6.0.11/24"
  interface: "edgevpn0"

services:
  - name: "service-a"
    address: "10.6.0.11:9001"
    tags: ["service", "backend"]
    health_check: "/health"
    
# ä¾èµ–æœåŠ¡
dependencies:
  - name: "database"
    required: true
  - name: "cache"
    required: false

# ç†”æ–­é…ç½®
circuit_breaker:
  enabled: true
  threshold: 5
  timeout: "30s"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/service-a-config.yaml
```

#### æ­¥éª¤ 3ï¼šæ•°æ®åº“é…ç½®

```bash
cat > /etc/edgevpn/database-config.yaml << 'EOF'
network:
  token: "å¾®æœåŠ¡ç½‘ç»œä»¤ç‰Œ"
  address: "10.6.0.101/24"
  interface: "edgevpn0"

services:
  - name: "database"
    address: "10.6.0.101:3306"
    tags: ["database", "mysql", "primary"]
    
  - name: "database-read"
    address: "10.6.0.102:3306"
    tags: ["database", "mysql", "replica"]

# è®¿é—®æ§åˆ¶
trustzone:
  enabled: true
  allowed_services:
    - "service-a"
    - "service-b"

logging:
  level: "warn"
EOF

edgevpn --config /etc/edgevpn/database-config.yaml
```

### 7.4 æœåŠ¡è°ƒç”¨ç¤ºä¾‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
curl http://10.6.0.1:8080/api/services

# æŸ¥çœ‹æœåŠ¡å®ä¾‹
curl http://10.6.0.1:8080/api/services/service-a

# å¥åº·æ£€æŸ¥
curl http://10.6.0.11:9001/health

# æœåŠ¡è°ƒç”¨ï¼ˆé€šè¿‡ç½‘å…³ï¼‰
curl http://10.6.0.1:8080/api/v1/resource

# ç›´æ¥è°ƒç”¨æœåŠ¡
curl http://10.6.0.11:9001/api/resource
```

### 7.5 æ³¨æ„äº‹é¡¹

1. **æœåŠ¡æ³¨å†Œ**ï¼šæœåŠ¡å¯åŠ¨åè‡ªåŠ¨æ³¨å†Œåˆ°åŒºå—é“¾è´¦æœ¬
2. **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ï¼Œè‡ªåŠ¨å‰”é™¤ä¸å¥åº·å®ä¾‹
3. **è´Ÿè½½å‡è¡¡**ï¼šç½‘å…³è‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹
4. **æ•…éšœè½¬ç§»**ï¼šæœåŠ¡å®ä¾‹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–å®ä¾‹
5. **è®¿é—®æ§åˆ¶**ï¼šä½¿ç”¨ä¿¡ä»»åŒºåŸŸé™åˆ¶æœåŠ¡è®¿é—®æƒé™

---

## 8. åœºæ™¯ä¸ƒï¼šè¾¹ç¼˜è®¡ç®—ç½‘ç»œ

### 8.1 åœºæ™¯æè¿°

é€‚ç”¨äºè¾¹ç¼˜è®¡ç®—åœºæ™¯ï¼Œåœ¨é è¿‘æ•°æ®æºçš„ä½ç½®éƒ¨ç½²è®¡ç®—èŠ‚ç‚¹ï¼Œé€šè¿‡ EdgeVPN å®ç°è¾¹ç¼˜èŠ‚ç‚¹ä¸äº‘ç«¯çš„ååŒè®¡ç®—ã€‚

### 8.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph EDGE["ğŸ–¥ï¸ è¾¹ç¼˜èŠ‚ç‚¹"]
        direction TB
        E_NODE1["è¾¹ç¼˜èŠ‚ç‚¹ 1<br/>å·¥å‚è½¦é—´<br/>10.7.0.11"]
        E_NODE2["è¾¹ç¼˜èŠ‚ç‚¹ 2<br/>ä»“åº“<br/>10.7.0.12"]
        E_NODE3["è¾¹ç¼˜èŠ‚ç‚¹ 3<br/>é…é€ä¸­å¿ƒ<br/>10.7.0.13"]
    end

    subgraph REGION["ğŸ¢ åŒºåŸŸä¸­å¿ƒ"]
        direction TB
        R_HUB["åŒºåŸŸæ±‡èšèŠ‚ç‚¹<br/>10.7.0.2"]
        R_CACHE["åŒºåŸŸç¼“å­˜"]
        R_PROCESS["åŒºåŸŸå¤„ç†"]
    end

    subgraph CLOUD["â˜ï¸ äº‘ç«¯"]
        direction TB
        C_MASTER["äº‘ç«¯ä¸»èŠ‚ç‚¹<br/>10.7.0.1"]
        C_ANALYTICS["æ•°æ®åˆ†æ"]
        C_AI["AI æ¨¡å‹"]
        C_STORAGE["äº‘å­˜å‚¨"]
    end

    E_NODE1 -->|"æ•°æ®"| R_HUB
    E_NODE2 -->|"æ•°æ®"| R_HUB
    E_NODE3 -->|"æ•°æ®"| R_HUB
    
    R_HUB --> R_CACHE
    R_HUB --> R_PROCESS
    R_HUB -->|"èšåˆæ•°æ®"| C_MASTER
    
    C_MASTER --> C_ANALYTICS
    C_MASTER --> C_AI
    C_MASTER --> C_STORAGE
    
    C_AI -.->|"æ¨¡å‹ä¸‹å‘"| E_NODE1
    C_AI -.->|"æ¨¡å‹ä¸‹å‘"| E_NODE2

    %% æ ·å¼å®šä¹‰
    classDef edgeStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef regionStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef cloudStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20

    class E_NODE1,E_NODE2,E_NODE3 edgeStyle
    class R_HUB,R_CACHE,R_PROCESS regionStyle
    class C_MASTER,C_ANALYTICS,C_AI,C_STORAGE cloudStyle
```

### 8.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šäº‘ç«¯ä¸»èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/cloud-master-config.yaml << 'EOF'
network:
  token: "è¾¹ç¼˜è®¡ç®—ç½‘ç»œä»¤ç‰Œ"
  address: "10.7.0.1/24"
  interface: "edgevpn0"

# é«˜å¯ç”¨é…ç½®
high_availability:
  enabled: true
  max_connections: 200

# æ•°æ®æ±‡èšé…ç½®
aggregation:
  enabled: true
  batch_size: 1000
  flush_interval: "30s"

# AI æ¨¡å‹åˆ†å‘
model_distribution:
  enabled: true
  model_dir: "/opt/models"
  version_control: true

# ä»»åŠ¡è°ƒåº¦
scheduler:
  enabled: true
  algorithm: "resource_aware"
  node_selection: "latency_based"

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/cloud-master-config.yaml
```

#### æ­¥éª¤ 2ï¼šåŒºåŸŸæ±‡èšèŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/region-hub-config.yaml << 'EOF'
network:
  token: "è¾¹ç¼˜è®¡ç®—ç½‘ç»œä»¤ç‰Œ"
  address: "10.7.0.2/24"
  interface: "edgevpn0"

# å¼•å¯¼èŠ‚ç‚¹
bootstrap:
  - "/ip4/äº‘ç«¯IP/tcp/4001/p2p/äº‘ç«¯PeerID"

# æ•°æ®ç¼“å­˜
cache:
  enabled: true
  type: "redis"
  address: "localhost:6379"
  ttl: "1h"

# æœ¬åœ°å¤„ç†
processing:
  enabled: true
  workers: 4
  queue_size: 1000

# æ•°æ®è½¬å‘
forwarding:
  enabled: true
  upstream: "10.7.0.1:8080"
  batch_size: 100
  interval: "10s"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/region-hub-config.yaml
```

#### æ­¥éª¤ 3ï¼šè¾¹ç¼˜èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/edge-node-config.yaml << 'EOF'
network:
  token: "è¾¹ç¼˜è®¡ç®—ç½‘ç»œä»¤ç‰Œ"
  address: "10.7.0.11/24"
  interface: "edgevpn0"

bootstrap:
  - "/ip4/åŒºåŸŸä¸­å¿ƒIP/tcp/4001/p2p/åŒºåŸŸPeerID"

# è¾¹ç¼˜è®¡ç®—é…ç½®
edge_compute:
  enabled: true
  gpu: true
  memory: "4GB"
  
# æœ¬åœ°æ¨ç†
inference:
  enabled: true
  model_path: "/opt/models/current"
  batch_size: 10
  
# æ•°æ®é‡‡é›†
data_collection:
  enabled: true
  sources:
    - type: "sensor"
      endpoint: "/dev/ttyUSB0"
      interval: "1s"
    - type: "camera"
      endpoint: "rtsp://camera.local/stream"
      fps: 30

# ç¦»çº¿æ¨¡å¼
offline:
  enabled: true
  cache_size: "10GB"
  sync_interval: "5m"

# èµ„æºé™åˆ¶
limits:
  cpu: "80%"
  memory: "4GB"
  bandwidth: "5MB/s"

logging:
  level: "warn"
EOF

edgevpn --config /etc/edgevpn/edge-node-config.yaml
```

### 8.4 ä»»åŠ¡è°ƒåº¦ç¤ºä¾‹

```bash
# æäº¤è®¡ç®—ä»»åŠ¡
curl -X POST http://10.7.0.1:8080/api/tasks \
  -d '{
    "name": "image-recognition",
    "model": "yolov5",
    "target_nodes": ["edge"],
    "priority": "high"
  }'

# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
curl http://10.7.0.1:8080/api/tasks/task-id

# æŸ¥çœ‹è¾¹ç¼˜èŠ‚ç‚¹çŠ¶æ€
curl http://10.7.0.1:8080/api/nodes

# ä¸‹å‘ AI æ¨¡å‹
curl -X POST http://10.7.0.1:8080/api/models/deploy \
  -d '{
    "model": "yolov5-v2",
    "target": "10.7.0.11"
  }'
```

### 8.5 æ³¨æ„äº‹é¡¹

1. **èµ„æºç®¡ç†**ï¼šè¾¹ç¼˜èŠ‚ç‚¹èµ„æºæœ‰é™ï¼Œéœ€è¦åˆç†åˆ†é…
2. **ç¦»çº¿èƒ½åŠ›**ï¼šè¾¹ç¼˜èŠ‚ç‚¹éœ€è¦æ”¯æŒç¦»çº¿è¿è¡Œ
3. **æ¨¡å‹æ›´æ–°**ï¼šæ”¯æŒå¢é‡æ›´æ–°å’Œç‰ˆæœ¬ç®¡ç†
4. **æ•°æ®å®‰å…¨**ï¼šæ•æ„Ÿæ•°æ®åœ¨è¾¹ç¼˜å¤„ç†ï¼Œå‡å°‘äº‘ç«¯ä¼ è¾“
5. **å»¶è¿Ÿä¼˜åŒ–**ï¼šé€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹è¿›è¡Œè®¡ç®—

---

## 9. åœºæ™¯å…«ï¼šç¾éš¾æ¢å¤ç½‘ç»œ

### 9.1 åœºæ™¯æè¿°

é€‚ç”¨äºç¾éš¾æ¢å¤åœºæ™¯ï¼Œåœ¨ä¸»æ•°æ®ä¸­å¿ƒæ•…éšœæ—¶ï¼Œé€šè¿‡ EdgeVPN å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®ä¸­å¿ƒï¼Œç¡®ä¿ä¸šåŠ¡è¿ç»­æ€§ã€‚

### 9.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph PRIMARY["ğŸ¢ ä¸»æ•°æ®ä¸­å¿ƒ"]
        direction TB
        P_VPN["EdgeVPN ä¸»èŠ‚ç‚¹<br/>10.8.0.1"]
        P_APP["åº”ç”¨æœåŠ¡å™¨"]
        P_DB["æ•°æ®åº“ä¸»"]
        P_STATUS["çŠ¶æ€: ğŸŸ¢ æ­£å¸¸"]
    end

    subgraph BACKUP["ğŸ¢ å¤‡ç”¨æ•°æ®ä¸­å¿ƒ"]
        direction TB
        B_VPN["EdgeVPN å¤‡èŠ‚ç‚¹<br/>10.8.0.2"]
        B_APP["åº”ç”¨æœåŠ¡å™¨"]
        B_DB["æ•°æ®åº“ä»"]
        B_STATUS["çŠ¶æ€: ğŸŸ¡ å¾…å‘½"]
    end

    subgraph MONITOR["ğŸ” ç›‘æ§ç³»ç»Ÿ"]
        direction TB
        M_HEALTH["å¥åº·æ£€æŸ¥"]
        M_FAILOVER["æ•…éšœè½¬ç§»"]
        M_ALERT["å‘Šè­¦é€šçŸ¥"]
    end

    P_VPN <-->|"æ•°æ®åŒæ­¥"| B_VPN
    P_DB -->|"å®æ—¶å¤åˆ¶"| B_DB
    
    M_HEALTH -->|"ç›‘æ§"| P_VPN
    M_HEALTH -->|"ç›‘æ§"| B_VPN
    M_FAILOVER -->|"åˆ‡æ¢"| B_VPN
    M_ALERT -->|"é€šçŸ¥"| M_FAILOVER

    P_STATUS -.->|"æ•…éšœ"| M_FAILOVER
    M_FAILOVER -.->|"æ¿€æ´»"| B_STATUS

    %% æ ·å¼å®šä¹‰
    classDef primaryStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20
    classDef backupStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef monitorStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0

    class P_VPN,P_APP,P_DB primaryStyle
    class B_VPN,B_APP,B_DB backupStyle
    class M_HEALTH,M_FAILOVER,M_ALERT monitorStyle
```

### 9.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šä¸»æ•°æ®ä¸­å¿ƒé…ç½®

```bash
cat > /etc/edgevpn/primary-config.yaml << 'EOF'
network:
  token: "ç¾éš¾æ¢å¤ç½‘ç»œä»¤ç‰Œ"
  address: "10.8.0.1/24"
  interface: "edgevpn0"

# é«˜å¯ç”¨é…ç½®
high_availability:
  enabled: true
  role: "primary"
  priority: 100
  
# å¥åº·æ£€æŸ¥
health_check:
  enabled: true
  interval: "10s"
  timeout: "5s"
  endpoints:
    - "/health"
    - "/ready"
    - "/live"

# æ•°æ®åŒæ­¥
sync:
  enabled: true
  target: "10.8.0.2"
  mode: "realtime"
  
# æ•…éšœè½¬ç§»é…ç½®
failover:
  enabled: true
  auto_failover: true
  threshold: 3
  cooldown: "60s"

# ç›‘æ§é…ç½®
monitoring:
  enabled: true
  metrics: true
  alerting: true
  alert_endpoints:
    - "webhook:https://alert.example.com/webhook"
    - "email:ops@example.com"

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/primary-config.yaml
```

#### æ­¥éª¤ 2ï¼šå¤‡ç”¨æ•°æ®ä¸­å¿ƒé…ç½®

```bash
cat > /etc/edgevpn/backup-config.yaml << 'EOF'
network:
  token: "ç¾éš¾æ¢å¤ç½‘ç»œä»¤ç‰Œ"
  address: "10.8.0.2/24"
  interface: "edgevpn0"

# å¼•å¯¼èŠ‚ç‚¹
bootstrap:
  - "/ip4/ä¸»æ•°æ®ä¸­å¿ƒIP/tcp/4001/p2p/ä¸»èŠ‚ç‚¹PeerID"

high_availability:
  enabled: true
  role: "backup"
  priority: 50

# æ•°æ®åŒæ­¥ï¼ˆæ¥æ”¶ç«¯ï¼‰
sync:
  enabled: true
  mode: "replica"
  
# æ•…éšœè½¬ç§»é…ç½®
failover:
  enabled: true
  auto_promote: true
  health_check_interval: "5s"
  
# å¾…å‘½æ¨¡å¼
standby:
  enabled: true
  resources: "minimal"
  
# ç›‘æ§é…ç½®
monitoring:
  enabled: true
  alerting: true

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/backup-config.yaml
```

#### æ­¥éª¤ 3ï¼šç›‘æ§ç³»ç»Ÿé…ç½®

```bash
cat > /etc/edgevpn/monitor-config.yaml << 'EOF'
network:
  token: "ç¾éš¾æ¢å¤ç½‘ç»œä»¤ç‰Œ"
  address: "10.8.0.100/24"
  interface: "edgevpn0"

# ç›‘æ§é…ç½®
monitoring:
  enabled: true
  targets:
    - address: "10.8.0.1"
      name: "primary"
      interval: "5s"
    - address: "10.8.0.2"
      name: "backup"
      interval: "5s"

# å‘Šè­¦è§„åˆ™
alerting:
  rules:
    - name: "primary_down"
      condition: "ping_failed > 3"
      action: "failover"
      severity: "critical"
      
    - name: "high_latency"
      condition: "latency > 1000ms"
      action: "alert"
      severity: "warning"

# æ•…éšœè½¬ç§»ç­–ç•¥
failover_policy:
  auto: true
  confirmation: false  # æ˜¯å¦éœ€è¦äººå·¥ç¡®è®¤
  rollback: true
  rollback_timeout: "5m"

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/monitor-config.yaml
```

### 9.4 æ•…éšœè½¬ç§»æ“ä½œ

```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
curl http://10.8.0.100:8080/api/ha/status

# æ‰‹åŠ¨è§¦å‘æ•…éšœè½¬ç§»
curl -X POST http://10.8.0.100:8080/api/ha/failover \
  -d '{"reason": "maintenance", "confirm": true}'

# æŸ¥çœ‹æ•…éšœè½¬ç§»å†å²
curl http://10.8.0.100:8080/api/ha/history

# å›æ»šåˆ°ä¸»æ•°æ®ä¸­å¿ƒ
curl -X POST http://10.8.0.100:8080/api/ha/rollback

# æŸ¥çœ‹å‘Šè­¦å†å²
curl http://10.8.0.100:8080/api/alerts
```

### 9.5 æ³¨æ„äº‹é¡¹

1. **æ•°æ®åŒæ­¥**ï¼šç¡®ä¿ä¸»å¤‡æ•°æ®å®æ—¶åŒæ­¥
2. **å¥åº·æ£€æŸ¥**ï¼šé…ç½®åˆç†çš„å¥åº·æ£€æŸ¥é—´éš”å’Œé˜ˆå€¼
3. **è‡ªåŠ¨åˆ‡æ¢**ï¼šè°¨æ…é…ç½®è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œé¿å…è¯¯åˆ‡æ¢
4. **å›æ»šæœºåˆ¶**ï¼šæ”¯æŒæ•…éšœæ¢å¤åçš„å›æ»šæ“ä½œ
5. **å®šæœŸæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œç¾éš¾æ¢å¤æ¼”ç»ƒ

---

## 10. åœºæ™¯ä¹ï¼šå®‰å…¨å®¡è®¡ç½‘ç»œ

### 10.1 åœºæ™¯æè¿°

é€‚ç”¨äºéœ€è¦ä¸¥æ ¼å®‰å…¨å®¡è®¡çš„åœºæ™¯ï¼Œé€šè¿‡ EdgeVPN å»ºç«‹å®‰å…¨å®¡è®¡ç½‘ç»œï¼Œè®°å½•æ‰€æœ‰ç½‘ç»œæ´»åŠ¨å’Œè®¿é—®æ—¥å¿—ã€‚

### 10.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph USERS["ğŸ‘¤ ç”¨æˆ·å±‚"]
        direction LR
        ADMIN["ç®¡ç†å‘˜"]
        AUDITOR["å®¡è®¡å‘˜"]
        OPERATOR["æ“ä½œå‘˜"]
    end

    subgraph ACCESS["ğŸšª è®¿é—®æ§åˆ¶å±‚"]
        direction TB
        GATEWAY["è®¿é—®ç½‘å…³<br/>10.9.0.1"]
        AUTH["è®¤è¯æœåŠ¡"]
        RBAC["æƒé™æ§åˆ¶"]
    end

    subgraph RESOURCES["ğŸ–¥ï¸ èµ„æºå±‚"]
        direction TB
        SERVER1["æœåŠ¡å™¨ A<br/>10.9.0.11"]
        SERVER2["æœåŠ¡å™¨ B<br/>10.9.0.12"]
        DATABASE["æ•°æ®åº“<br/>10.9.0.13"]
    end

    subgraph AUDIT["ğŸ“‹ å®¡è®¡å±‚"]
        direction TB
        LOG["æ—¥å¿—æ”¶é›†"]
        ANALYSIS["æ—¥å¿—åˆ†æ"]
        REPORT["å®¡è®¡æŠ¥å‘Š"]
    end

    ADMIN -->|"è®¿é—®"| GATEWAY
    AUDITOR -->|"è®¿é—®"| GATEWAY
    OPERATOR -->|"è®¿é—®"| GATEWAY
    
    GATEWAY --> AUTH
    AUTH --> RBAC
    
    RBAC -->|"æˆæƒè®¿é—®"| SERVER1
    RBAC -->|"æˆæƒè®¿é—®"| SERVER2
    RBAC -->|"æˆæƒè®¿é—®"| DATABASE
    
    GATEWAY -.->|"æ—¥å¿—"| LOG
    SERVER1 -.->|"æ—¥å¿—"| LOG
    SERVER2 -.->|"æ—¥å¿—"| LOG
    DATABASE -.->|"æ—¥å¿—"| LOG
    
    LOG --> ANALYSIS
    ANALYSIS --> REPORT

    %% æ ·å¼å®šä¹‰
    classDef userStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef accessStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef resourceStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20
    classDef auditStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#4A148C

    class ADMIN,AUDITOR,OPERATOR userStyle
    class GATEWAY,AUTH,RBAC accessStyle
    class SERVER1,SERVER2,DATABASE resourceStyle
    class LOG,ANALYSIS,REPORT auditStyle
```

### 10.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šè®¿é—®ç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/audit-gateway-config.yaml << 'EOF'
network:
  token: "å®¡è®¡ç½‘ç»œä»¤ç‰Œ"
  address: "10.9.0.1/24"
  interface: "edgevpn0"

# è®¿é—®æ§åˆ¶
access_control:
  enabled: true
  auth_method: "ecdsa"
  
  # ç”¨æˆ·æƒé™é…ç½®
  users:
    - id: "admin"
      role: "administrator"
      permissions: ["*"]
    - id: "auditor"
      role: "auditor"
      permissions: ["read", "audit"]
    - id: "operator"
      role: "operator"
      permissions: ["read", "execute"]

# å®¡è®¡é…ç½®
audit:
  enabled: true
  log_all: true
  log_level: "detailed"
  
  # å®¡è®¡æ—¥å¿—å­˜å‚¨
  storage:
    type: "elasticsearch"
    address: "http://elasticsearch:9200"
    index: "edgevpn-audit"
    
  # æ•æ„Ÿæ“ä½œè®°å½•
  sensitive_operations:
    - "file_transfer"
    - "configuration_change"
    - "user_management"
    - "access_control_change"

# ä¼šè¯ç®¡ç†
session:
  timeout: "8h"
  max_sessions: 10
  concurrent_limit: 3

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/audit-gateway-config.yaml
```

#### æ­¥éª¤ 2ï¼šèµ„æºæœåŠ¡å™¨é…ç½®

```bash
cat > /etc/edgevpn/audit-server-config.yaml << 'EOF'
network:
  token: "å®¡è®¡ç½‘ç»œä»¤ç‰Œ"
  address: "10.9.0.11/24"
  interface: "edgevpn0"

# è®¿é—®æ§åˆ¶
trustzone:
  enabled: true
  allowed_roles:
    - "administrator"
    - "operator"

# å®¡è®¡æ—¥å¿—
audit:
  enabled: true
  
  # æ“ä½œè®°å½•
  operations:
    - type: "ssh"
      log_commands: true
    - type: "file"
      log_access: true
    - type: "database"
      log_queries: true
      
  # æ—¥å¿—è½¬å‘
  forward:
    enabled: true
    target: "10.9.0.1:8080"
    batch_size: 100
    interval: "10s"

# èµ„æºé™åˆ¶
limits:
  max_connections: 50
  rate_limit: "100/min"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/audit-server-config.yaml
```

### 10.4 å®¡è®¡æ“ä½œç¤ºä¾‹

```bash
# æŸ¥çœ‹å®¡è®¡æ—¥å¿—
curl http://10.9.0.1:8080/api/audit/logs \
  -H "Authorization: Bearer $TOKEN"

# æŸ¥çœ‹ç”¨æˆ·æ´»åŠ¨
curl http://10.9.0.1:8080/api/audit/users/admin/activity

# æŸ¥çœ‹æ•æ„Ÿæ“ä½œ
curl http://10.9.0.1:8080/api/audit/sensitive

# ç”Ÿæˆå®¡è®¡æŠ¥å‘Š
curl -X POST http://10.9.0.1:8080/api/audit/report \
  -d '{
    "start": "2024-01-01T00:00:00Z",
    "end": "2024-01-31T23:59:59Z",
    "type": "monthly"
  }'

# æŸ¥çœ‹è®¿é—®ç»Ÿè®¡
curl http://10.9.0.1:8080/api/audit/statistics
```

### 10.5 æ³¨æ„äº‹é¡¹

1. **æ—¥å¿—å®Œæ•´æ€§**ï¼šç¡®ä¿å®¡è®¡æ—¥å¿—ä¸å¯ç¯¡æ”¹
2. **æ—¥å¿—å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½å®¡è®¡æ—¥å¿—
3. **è®¿é—®æ§åˆ¶**ï¼šä¸¥æ ¼æ§åˆ¶å®¡è®¡æ—¥å¿—çš„è®¿é—®æƒé™
4. **åˆè§„è¦æ±‚**ï¼šæ ¹æ®è¡Œä¸šåˆè§„è¦æ±‚é…ç½®å®¡è®¡ç­–ç•¥
5. **æ€§èƒ½å½±å“**ï¼šå®¡è®¡åŠŸèƒ½å¯èƒ½å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œéœ€è¦å¹³è¡¡

---

## 11. åœºæ™¯åï¼šæ··åˆäº‘ç½‘ç»œ

### 11.1 åœºæ™¯æè¿°

é€‚ç”¨äºæ··åˆäº‘åœºæ™¯ï¼Œå°†æœ¬åœ°æ•°æ®ä¸­å¿ƒä¸å…¬æœ‰äº‘èµ„æºé€šè¿‡ EdgeVPN äº’è”ï¼Œå®ç°ç»Ÿä¸€çš„ç½‘ç»œç®¡ç†ã€‚

### 11.2 æ¶æ„å›¾

```mermaid
flowchart TB
    subgraph ONPREM["ğŸ¢ æœ¬åœ°æ•°æ®ä¸­å¿ƒ"]
        direction TB
        O_VPN["EdgeVPN ç½‘å…³<br/>10.10.0.1"]
        O_APP["åº”ç”¨æœåŠ¡å™¨"]
        O_DB["æ•°æ®åº“"]
        O_STORAGE["å­˜å‚¨ç³»ç»Ÿ"]
    end

    subgraph AWS["â˜ï¸ AWS äº‘"]
        direction TB
        A_VPN["EdgeVPN èŠ‚ç‚¹<br/>10.10.0.11"]
        A_EC2["EC2 å®ä¾‹"]
        A_RDS["RDS æ•°æ®åº“"]
        A_S3["S3 å­˜å‚¨"]
    end

    subgraph AZURE["â˜ï¸ Azure äº‘"]
        direction TB
        Z_VPN["EdgeVPN èŠ‚ç‚¹<br/>10.10.0.21"]
        Z_VM["è™šæ‹Ÿæœº"]
        Z_SQL["SQL æ•°æ®åº“"]
        Z_BLOB["Blob å­˜å‚¨"]
    end

    subgraph ALIYUN["â˜ï¸ é˜¿é‡Œäº‘"]
        direction TB
        L_VPN["EdgeVPN èŠ‚ç‚¹<br/>10.10.0.31"]
        L_ECS["ECS å®ä¾‹"]
        L_RDS["RDS æ•°æ®åº“"]
        L_OSS["OSS å­˜å‚¨"]
    end

    O_VPN <-->|"VPN éš§é“"| A_VPN
    O_VPN <-->|"VPN éš§é“"| Z_VPN
    O_VPN <-->|"VPN éš§é“"| L_VPN
    
    A_VPN <-->|"äº‘é—´äº’è”"| Z_VPN
    Z_VPN <-->|"äº‘é—´äº’è”"| L_VPN
    A_VPN <-->|"äº‘é—´äº’è”"| L_VPN

    %% æ ·å¼å®šä¹‰
    classDef onpremStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px,color:#1565C0
    classDef awsStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px,color:#E65100
    classDef azureStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px,color:#1B5E20
    classDef aliyunStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px,color:#4A148C

    class O_VPN,O_APP,O_DB,O_STORAGE onpremStyle
    class A_VPN,A_EC2,A_RDS,A_S3 awsStyle
    class Z_VPN,Z_VM,Z_SQL,Z_BLOB azureStyle
    class L_VPN,L_ECS,L_RDS,L_OSS aliyunStyle
```

### 11.3 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1ï¼šæœ¬åœ°æ•°æ®ä¸­å¿ƒç½‘å…³é…ç½®

```bash
cat > /etc/edgevpn/onprem-config.yaml << 'EOF'
network:
  token: "æ··åˆäº‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.10.0.1/24"
  interface: "edgevpn0"

# å¤šäº‘è·¯ç”±é…ç½®
routing:
  enabled: true
  routes:
    - destination: "10.10.0.0/24"
      gateway: "10.10.0.1"
    - destination: "172.31.0.0/16"  # AWS VPC
      gateway: "10.10.0.11"
    - destination: "10.0.0.0/16"    # Azure VNet
      gateway: "10.10.0.21"
    - destination: "192.168.0.0/16" # é˜¿é‡Œäº‘ VPC
      gateway: "10.10.0.31"

# NAT ç©¿é€
nat:
  traversal: true
  stun_server: "stun.l.google.com:19302"

# é«˜å¯ç”¨
high_availability:
  enabled: true
  failover_nodes:
    - "10.10.0.2"

api:
  enabled: true
  listen: "0.0.0.0:8080"

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/onprem-config.yaml
```

#### æ­¥éª¤ 2ï¼šAWS äº‘èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/aws-config.yaml << 'EOF'
network:
  token: "æ··åˆäº‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.10.0.11/24"
  interface: "edgevpn0"

# å¼•å¯¼èŠ‚ç‚¹
bootstrap:
  - "/ip4/æœ¬åœ°æ•°æ®ä¸­å¿ƒIP/tcp/4001/p2p/æœ¬åœ°PeerID"

# AWS ç‰¹å®šé…ç½®
cloud:
  provider: "aws"
  region: "us-east-1"
  
# VPC è·¯ç”±
routing:
  enabled: true
  routes:
    - destination: "172.31.0.0/16"
      gateway: "10.10.0.11"
    - destination: "10.10.0.0/24"
      gateway: "10.10.0.1"

# æœåŠ¡å‘ç°
services:
  - name: "aws-api"
    address: "10.10.0.11:8080"
    tags: ["aws", "api"]

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/aws-config.yaml
```

#### æ­¥éª¤ 3ï¼šAzure äº‘èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/azure-config.yaml << 'EOF'
network:
  token: "æ··åˆäº‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.10.0.21/24"
  interface: "edgevpn0"

bootstrap:
  - "/ip4/æœ¬åœ°æ•°æ®ä¸­å¿ƒIP/tcp/4001/p2p/æœ¬åœ°PeerID"

cloud:
  provider: "azure"
  region: "eastus"

routing:
  enabled: true
  routes:
    - destination: "10.0.0.0/16"
      gateway: "10.10.0.21"
    - destination: "10.10.0.0/24"
      gateway: "10.10.0.1"

services:
  - name: "azure-api"
    address: "10.10.0.21:8080"
    tags: ["azure", "api"]

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/azure-config.yaml
```

#### æ­¥éª¤ 4ï¼šé˜¿é‡Œäº‘èŠ‚ç‚¹é…ç½®

```bash
cat > /etc/edgevpn/aliyun-config.yaml << 'EOF'
network:
  token: "æ··åˆäº‘ç½‘ç»œä»¤ç‰Œ"
  address: "10.10.0.31/24"
  interface: "edgevpn0"

bootstrap:
  - "/ip4/æœ¬åœ°æ•°æ®ä¸­å¿ƒIP/tcp/4001/p2p/æœ¬åœ°PeerID"

cloud:
  provider: "aliyun"
  region: "cn-hangzhou"

routing:
  enabled: true
  routes:
    - destination: "192.168.0.0/16"
      gateway: "10.10.0.31"
    - destination: "10.10.0.0/24"
      gateway: "10.10.0.1"

services:
  - name: "aliyun-api"
    address: "10.10.0.31:8080"
    tags: ["aliyun", "api"]

logging:
  level: "info"
EOF

edgevpn --config /etc/edgevpn/aliyun-config.yaml
```

### 11.4 æ··åˆäº‘æ“ä½œç¤ºä¾‹

```bash
# æŸ¥çœ‹æ‰€æœ‰äº‘èŠ‚ç‚¹
curl http://10.10.0.1:8080/api/nodes

# ä»æœ¬åœ°è®¿é—® AWS èµ„æº
curl http://172.31.0.10:8080/api

# ä» AWS è®¿é—®æœ¬åœ°èµ„æº
ssh user@10.10.0.1

# è·¨äº‘æ•°æ®ä¼ è¾“
# AWS åˆ° Azure
scp user@172.31.0.10:/data/file.txt user@10.0.0.10:/backup/

# æŸ¥çœ‹è·¯ç”±è¡¨
curl http://10.10.0.1:8080/api/routes
```

### 11.5 æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œå»¶è¿Ÿ**ï¼šè·¨äº‘è®¿é—®å»¶è¿Ÿè¾ƒé«˜ï¼Œéœ€è¦ä¼˜åŒ–åº”ç”¨
2. **å¸¦å®½æˆæœ¬**ï¼šè·¨äº‘æµé‡æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦ç›‘æ§å’Œæ§åˆ¶
3. **å®‰å…¨é…ç½®**ï¼šç¡®ä¿å„äº‘å¹³å°çš„å®‰å…¨ç»„é…ç½®æ­£ç¡®
4. **æ•°æ®åˆè§„**ï¼šæ³¨æ„æ•°æ®è·¨å¢ƒä¼ è¾“çš„åˆè§„è¦æ±‚
5. **æ•…éšœéš”ç¦»**ï¼šå•äº‘æ•…éšœä¸åº”å½±å“å…¶ä»–äº‘çš„æ­£å¸¸è¿è¡Œ

---

## 12. æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†åç§çœŸå®ä¸šåŠ¡åœºæ™¯ä¸‹çš„ EdgeVPN éƒ¨ç½²ç¤ºä¾‹ï¼Œæ¶µç›–äº†ï¼š

1. **å®¶åº­åŠå…¬**ï¼šè¿œç¨‹å®‰å…¨è®¿é—®å…¬å¸å†…ç½‘
2. **å¼€å‘æµ‹è¯•**ï¼šå¤šå¼€å‘è€…ç¯å¢ƒäº’è”
3. **å¤šåœ°åŸŸåä½œ**ï¼šè·¨åœ°åŸŸåˆ†å¸ƒå¼å›¢é˜Ÿåä½œ
4. **IoT äº’è”**ï¼šç‰©è”ç½‘è®¾å¤‡å®‰å…¨äº’è”
5. **æ–‡ä»¶å…±äº«**ï¼šå®‰å…¨æ–‡ä»¶ä¼ è¾“å’Œå…±äº«
6. **å¾®æœåŠ¡**ï¼šå¾®æœåŠ¡æ¶æ„çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
7. **è¾¹ç¼˜è®¡ç®—**ï¼šè¾¹ç¼˜èŠ‚ç‚¹ä¸äº‘ç«¯ååŒè®¡ç®—
8. **ç¾éš¾æ¢å¤**ï¼šä¸»å¤‡æ•°æ®ä¸­å¿ƒæ•…éšœè½¬ç§»
9. **å®‰å…¨å®¡è®¡**ï¼šç½‘ç»œè®¿é—®å®¡è®¡å’Œæ—¥å¿—è®°å½•
10. **æ··åˆäº‘**ï¼šå¤šäº‘ç¯å¢ƒç»Ÿä¸€ç½‘ç»œç®¡ç†

æ¯ä¸ªåœºæ™¯éƒ½æä¾›äº†è¯¦ç»†çš„æ¶æ„è®¾è®¡ã€éƒ¨ç½²æ­¥éª¤å’Œé…ç½®ç¤ºä¾‹ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œå¹¶æ ¹æ®ç¤ºä¾‹è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚
