# ============================================================================
# GitHub Pages éƒ¨ç½²å·¥ä½œæµ
# ç”¨é€”ï¼šæ„å»ºæ–‡æ¡£ç«™ç‚¹å¹¶éƒ¨ç½²åˆ° GitHub Pages
# è§¦å‘æ¡ä»¶ï¼šæ¨é€åˆ° master åˆ†æ”¯
# ä½œè€…ï¼špurpose168@outlook.com
# ============================================================================

name: GitHub Pages
on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    # æ£€å‡ºä»£ç ä»“åº“ï¼ˆåŒ…å«å­æ¨¡å—ï¼‰
    - uses: actions/checkout@v4
      with:
        submodules: 'recursive'  # é€’å½’æ£€å‡ºæ‰€æœ‰å­æ¨¡å—

    # æ„å»ºæ–‡æ¡£ç«™ç‚¹
    - name: æ„å»º ğŸ”§
      run: |
           # è¿›å…¥æ–‡æ¡£ç›®å½•å¹¶æ„å»º
           cd docs && make build
           # å°†ç”Ÿæˆçš„é™æ€æ–‡ä»¶ç§»åŠ¨åˆ°æ ¹ç›®å½•
           mv public ../

    # éƒ¨ç½²åˆ° GitHub Pages
    - name: éƒ¨ç½² ğŸš€
      # ä»…åœ¨ master åˆ†æ”¯çš„æ¨é€äº‹ä»¶æ—¶æ‰§è¡Œéƒ¨ç½²
      if: github.ref == 'refs/heads/master' && github.event_name == 'push'
      uses: JamesIves/github-pages-deploy-action@releases/v3
      with:
        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}  # ç”¨äºæ¨é€çš„è®¿é—®ä»¤ç‰Œ
        BRANCH: gh-pages                           # éƒ¨ç½²ç›®æ ‡åˆ†æ”¯
        FOLDER: public                             # è¦éƒ¨ç½²çš„æ–‡ä»¶å¤¹
